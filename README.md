# A10-UnvaliAdated Redirects and Forwards

## How the flaw can be identified?

### Owasp Zap
1. Start Owasp Zap
2. Start the application
3. Configure your browser to use the Zap proxy
4. Go to address localhost:8080/form in the browser
5. Send a signup with the ui
6. Go to the Zap and look for messages under site http://localhost:8080
7. Choose the most recent message named GET:formSave(address,name,redirect)
8. Open active scan dialog for the message
9. Start the scan with default options
10. Look for Alerts tab
11. There should be "External Redirect" alerts
12. Look for the related POST message (Request)
13. Identify the redirect parameter with replaced address
14. Copy the url of the GET (e.g.http://localhost:8080/formSave?name=test&address=test&redirect=http%3A%2F%2F4728989909065774721.owasp.org) and replace the redirect address with e.g. https://www.owasp.org/index.php/Top_10_2013-A10-Unvalidated_Redirects_and_Forwards
15. Copy the modified address to your browser and test it out.

## How the flaw can be fixed?
Do not use redirect-parameters on the first hand. And if it's really needed to use redirect-parameters, then the parameters should be whitelisted. Whitelisted so that in each redirect only explicitly allowed addresses are allowed.

In code level redirect parameter should be removed from form-view. Also in signupcontrollers submitForm-method redirect parameter is not needed and should be removed. Or whitelisted.

Also using GET verb for submitting data from the form is bad. Using GET in the form (and in the back end) makes it possible to use the form page for redirection attacks.

# A3-Cross-Site Scripting (XSS)

## How the flaw can be identified?

### Manual way
This one can be identified by submitting e.g. script <script>alert("muahaha")</script> to name or address or both on the form.

### Owasp Zap
1. Start Owasp Zap
2. Make sure there's some fuzzing databases installed in your zap: E.g. add-ons -> FuzzDB files
3. Start the application
4. Configure your browser to use the Zap proxy
5. Go to address localhost:8080/form in the browser
6. Send a signup with the ui
7. Go to the Zap and look for messages under site http://localhost:8080
8. Choose the most recent message named GET:formSave(address,name,redirect)
9. Check out the request and select a parameter you sent
10. Second click with mouse on selected parameter
11. Select Fuzz
12. Click Payloads
13. Add -> File Fuzzers from the top -> fuzzdb -> attack -> xss
14. Click Add
15. Click Ok
16. Go to options tab -> Enable "Follow Redirects" from the bottom
17. Click Start Fuzzer
18. Enjoy
19. Order the results by State and find out some reflected results
20. Try few by hand
21. And if you want to be victim of all the buzzes, go to localhost:8080/signups

## How the flaw can be fixed?
There should be some basic sanitazing for the parameters in back end. For name and address only alphabets and numbers could be allowed.

Also escaping all html by default could be helpful. It's actually difficult at first to put non escaped string on page generated by spring + thymeleaf. Make sure that all data from models are escaped when delivered on html page. Avoid with thymeleaf using utext: <p th:utext="${name}">name</p>.